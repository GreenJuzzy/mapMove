var lastMap,fs=require("fs"),process=require("process"),chalk=require("chalk"),currentMap=fs.readFileSync(__dirname+"/map.txt","utf-8");process.stdin.setRawMode(!0);let settings={character:"*",border:"#",walkThrough:"-",spacing:5,interactable:""};var formatMap=async e=>{var a=[];return e=e.replaceAll("\r","").replaceAll(" ",settings.border).split("\n").forEach((e,r,t)=>{a[r]=e.split("")}),a.forEach((e,r,t)=>{""==e[e.length-1]&&e.pop()}),a},move=async(e,r,t,s)=>{var a;if(!s.join("").includes(settings.character))return{error:"No character found.",map:s};var n={row:async()=>{var a;return s.join("").includes(settings.character)&&(s.filter((e,t,r)=>{e.filter((e,r)=>{e.includes(settings.character)&&(a={val:e,row:t,indexRow:r})})}),a)||s},left:async()=>{var e,r;return s.join("").includes(settings.character)&&(e=s,r=await n.row(),s[r.row][r.indexRow]!=s[r.row][0])&&settings.walkThrough.includes(s[r.row][r.indexRow-1])&&settings.border!=s[r.row][r.indexRow-1]?(e[r.row][r.indexRow-1]=settings.character,e[r.row][r.indexRow]=settings.walkThrough,e):s},right:async()=>{var e,r;return s.join("").includes(settings.character)&&(e=s,r=await n.row(),s[r.row][r.indexRow]!=s[r.row][s[r.row].length-1])&&settings.walkThrough.includes(s[r.row][r.indexRow+1])&&settings.border!=s[r.row][r.indexRow+1]?(e[r.row][r.indexRow+1]=settings.character,e[r.row][r.indexRow]=settings.walkThrough,e):s},up:async()=>{var e,r;return s.join("").includes(settings.character)&&(e=s,r=await n.row(),s[r.row][r.indexRow]!=s[0][r.indexRow])&&settings.walkThrough.includes(s[r.row-1][r.indexRow])&&settings.border!=s[r.row-1][r.indexRow]?(e[r.row-1][r.indexRow]=settings.character,e[r.row][r.indexRow]=settings.walkThrough,e):s},down:async()=>{var e,r;return s.join("").includes(settings.character)&&(e=s,r=await n.row(),s[r.row][r.indexRow]!=s[s.length-1][r.indexRow])&&settings.walkThrough.includes(s[r.row+1][r.indexRow])&&settings.border!=s[r.row+1][r.indexRow]?(e[r.row+1][r.indexRow]=settings.character,e[r.row][r.indexRow]=settings.walkThrough,e):s}};switch(e){case"w":(a=n.up())==s&&(a=s);break;case"s":(a=n.down())==s&&(a=s);break;case"a":(a=n.left())==s&&(a=s);break;case"d":(a=n.right())==s&&(a=s)}return a};(async()=>{var r=await formatMap(currentMap);process.stdin.on("data",async e=>{console.clear(),process.stdout.write("[?25l");return"v"==(e=e.toString().replace("\r\n",""))?lastMap.forEach((e,r)=>{console.log("  "+e.join(" ".repeat(settings.spacing)).replace(settings.character,chalk.red(settings.character))+"\n")}):["w","a","s","d"].includes(e)?void(JSON.stringify(void 0)!=JSON.stringify(await move(e,0,settings.character,r))&&(e=await move(e,0,settings.character,r),(lastMap=e).forEach((e,r)=>{console.log("  "+e.join(" ".repeat(settings.spacing)).replace(settings.character,chalk.red(settings.character)).replaceAll(settings.border,chalk.blue(settings.border)).replaceAll(settings.walkThrough," ")+"\n")}))):lastMap.forEach((e,r)=>{console.log("  "+e.join(" ".repeat(settings.spacing)).replace(settings.character,chalk.red(settings.character)).replaceAll(settings.border,chalk.blue(settings.border)).replaceAll(settings.walkThrough," ")+"\n")})})})();